---
deployment:
  tasks:
    # Set deployment paths for MISEDA INSPECT SRL hosting
    - export DEPLOYPATH=/home/aduadu321/public_html/
    - export APPPATH=/home/aduadu321/itp-notification/
    
    # Create necessary directories
    - mkdir -p $APPPATH
    - mkdir -p $DEPLOYPATH
    
    # Build and create deployment packages
    - npm run build
    - npm run server:build || npx tsc --project tsconfig.server.json
    - npm run zip:deploy
    - npm run zip:frontend
    
    # Deploy from zip archives
    - cd $APPPATH && unzip -o ../../../itp-notification-deploy.zip
    - cd $DEPLOYPATH && unzip -o ../../../itp-frontend-public.zip
    
    # Install production dependencies for backend
    - cd $APPPATH && npm ci --omit=dev
    
    # Clean up zip files
    - rm -f /home/aduadu321/itp-notification-deploy.zip
    - rm -f /home/aduadu321/itp-frontend-public.zip
    
    # Set proper permissions
    - chmod -R 755 $DEPLOYPATH
    - chmod -R 755 $APPPATH
    
    # Restart Node.js application (if supported by hosting)
    - echo "Deployment completed for ITP NOTIFICATION - MISEDA INSPECT SRL"